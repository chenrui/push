/*! appstore */
function reset_add_category_form(){$("#input-category-id").val("-1"),$("#category-type").val("-1"),$("#category-name-check").html("<small>分类名称建议不超过7个字</small>"),$("#add-category-name").val(""),$("#selected-category-icon").val(""),$("#input-category-icon").val(""),$("#category-type").removeAttr("disabled"),$("#btn-category-icon").parent().find("img").attr("src",""),$("#recommend_app_1").val(""),$("#recommend_app_2").val(""),$("#category-description").val(""),$("#operate-category-title").html("增加分类"),$("#category-type").removeAttr("disabled"),$(".upload_preview").html("").addClass("hidden"),$(".check-icon").addClass("hidden"),$(".fileinput-button").attr("title","未选择文件")}function is_iE(){return!!window.ActiveXObject}$(function(){bootbox.setDefaults({locale:"zh_CN"}),$(".category_priority").update("/admin/category/priority/update/"),$(".btn-clsf-del").click(function(){var a=$(this).parent().parent().find(".clsf-check-item").val();bootbox.confirm("请确定是否删除所选分类?",function(b){b&&(params={url:"/admin/category/delete/",data:{id:a}},$.sendAjax(params))})}),$.selectAllToggle("capl-check","capl-check-item");var a="/admin/category/list_app/update/"+$("#category_id").val()+"/";$(".category_app_priority").update(a),$("#btn-capl-sw").click(function(){var a=$.checkboxVal("capl-check-item");a.length>0?bootbox.confirm("选择下架后，你投放的资源将被移除，是否继续？",function(b){if(b){var c={ids:a},d="/admin/category/list_app/offshelf/"+$("#category_id").val()+"/";$.sendAjax({url:d,type:"POST",data:c})}}):bootbox.alert("请先选择，然后才能进行下架操作!",function(){})}),$("#btn-cat-add").click(function(){reset_add_category_form()}),$("#add-category-name").blur(function(){$.isNull($.trim($(this).val()))?$("#category-name-check").html("<img src='/static/common/images/error.png' /><span class='label label-warning'>分类名称不能为空</span>"):$.strLength($.trim($(this).val()),15)?$.sendAjax({url:"/admin/category/name/check/",type:"POST",data:{name:$.trim($(this).val()),category_id:$("#input-category-id").val()},callback:function(a){$("#category-name-check").html("success"==a.status?"<img src='/static/common/images/right.png' />":"<img src='/static/common/images/error.png' /><span class='label label-warning'>"+a.msg+"</span>")}}):$("#category-name-check").html("<img src='/static/common/images/error.png' /><span class='label label-warning'>分类名称长度要小于15个字</span>")});var b=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"choose-icon",uptoken_url:"/admin/qiniu/token",domain:"tcl-cd-test.qiniudn.com",container:"container-icon",max_file_size:"100kb",flash_swf_url:"../../../../static/plugin/qiniu/js/plupload/Moxie.swf",max_retries:0,dragdrop:!1,auto_start:!1,multi_selection:!1,unique_names:!0,save_key:!0,init:{FilesAdded:function(a,c){if(c[0].type.indexOf("image")<0)return a.files.pop(),alert("请上传图片文件"),!1;a.files.length>1&&a.files.shift();var d=a.files[0],e="",f=a.settings,g=$(f.browse_button[0]),h=g.parent().parent().find(".upload_preview"),i=g.parent().parent().find(".progress-bar"),j=g.parent().parent().find(".progress"),k=g.parent().parent().find(".file-submit"),l=(g.parent().parent().find(".file-abort"),g.parent().find("i.check-icon")),m=g.parent().parent().find(".upload_inf"),n=$("#icon-path"),o=new FileReader;o.onload=function(c){e='<div><a class="upload_delete close glyphicon glyphicon-remove" title="删除"></a><img  src="'+c.target.result+'" class="upload_image img-thumbnail" /></div>',h.html(e).removeClass("hidden"),i.css("width","0"),j.removeClass("hidden"),g.attr("title",d.name),k.removeClass("hidden"),l.addClass("hidden"),m.html("").addClass("hidden"),h.delegate(".upload_delete","click",function(){a.files.pop(),l.addClass("hidden"),h.html("").addClass("hidden"),i.css("width","0"),j.addClass("hidden"),k.addClass("hidden"),g.attr("title","未选择文件"),n.val(""),m.html("").addClass("hidden")}),n.val(""),k[0].onclick=function(){m.html("").addClass("hidden"),b.start()}},o.readAsDataURL(d.getNative())},BeforeUpload:function(a){var c=a.settings,d=$(c.browse_button[0]),e=d.parent().parent().find(".progress"),f=d.parent().parent().find(".progress-bar"),g=d.parent().parent().find(".file-submit"),h=d.parent().parent().find(".file-abort"),i=d.parent().parent().find(".upload_delete"),j=d.parent().parent().find(".upload_inf");g.addClass("hidden"),h.removeClass("hidden"),i.addClass("hidden"),e.addClass("active"),h.click(function(){b.stop(),f.css("width","0"),$(this).addClass("hidden"),g.removeClass("hidden"),j.html('<i class="icon-warning-sign"> 文件上传失败：用户终止上传').removeClass("hidden")})},UploadProgress:function(a,b){var c=a.settings,d=$(c.browse_button[0]),e=(d.parent().parent().find(".file-abort"),d.parent().parent().find(".progress-bar"));e.css("width",b.percent+"%")},FileUploaded:function(a,b,c){var d=$.parseJSON(c);if(!d)return void bootbox.alert("上传专题icon文件失败");$("#icon-path").val(d.key+","+d.name);var e=a.settings,f=$(e.browse_button[0]),g=f.parent().parent().find(".progress"),h=(f.parent().parent().find(".file-submit"),f.parent().parent().find(".file-abort")),i=f.parent().parent().find(".upload_delete"),j=f.parent().find("i.check-icon");h.addClass("hidden"),i.removeClass("hidden"),j.removeClass("hidden"),g.removeClass("active")},Error:function(a,b,c){var d=a.settings,e=$(d.browse_button[0]),f=(e.parent().parent().find(".file-submit"),e.parent().parent().find(".file-abort")),g=e.parent().parent().find(".progress"),h=e.parent().parent().find(".upload_delete"),i=e.parent().find("i.check-icon"),j=$("#video_cover_name"),k=e.parent().parent().find(".upload_inf");h.removeClass("hidden"),f.addClass("hidden"),i.addClass("hidden"),j.val(""),g.removeClass("active"),k.html('<i class="icon-warning-sign"> '+c).removeClass("hidden")},UploadComplete:function(){}}});$("#btn-add-category").click(function(){$("#btn-add-category-real").click()}),$("#btn-add-category-real").click(function(){if($.isNull($.trim($("#add-category-name").val())))return bootbox.alert("分类名称不能为空"),!1;if(""!=$.trim($("#add-category-name").val())&&$.strLength($.trim($("#add-category-name").val()),15)&&$.sendAjax({url:"/admin/category/name/check/",type:"POST",data:{name:$.trim($("#add-category-name").val()),category_id:$("#input-category-id").val()},sync:!1,callback:function(a){$("#category-name-check").html("success"==a.status?"<img src='/static/common/images/right.png' />":"<img src='/static/common/images/error.png' /><span class='label label-warning'>"+a.msg+"</span>")}}),!$.strLength($.trim($("#add-category-name").val()),15))return bootbox.alert("分类名称长度要小于15个字"),!1;if("/static/common/images/right.png"!=$("#category-name-check").find("img").attr("src"))return bootbox.alert("无效的分类名"),!1;if($.isNull($("#icon-path").val())){var a="";return a=""===$("#preview-icon").html()?"请选择Icon":"请上传icon",bootbox.alert(a),!1}return"-1"==$("#category-type").val()?(bootbox.alert("请选择分类类型"),!1):$.strLength($.trim($("#recommend_app_1").val()),14)&&$.strLength($.trim($("#recommend_app_2").val()),14)?$.isNull($("#category-description").val())?(bootbox.alert("分类描述不能为空"),!1):void 0:(bootbox.alert("推荐应用字数不能超过14个"),!1)}),$(".btn-modify-category").click(function(){reset_add_category_form(),$.sendAjax({url:"/admin/category/info/",type:"POST",data:{category_id:$(this).attr("value")},callback:function(a){if("success"==a.status){$("#input-category-id").val(a.id),$("#add-category-name").val(a.name),$("#category-name-check").html("<img src='/static/common/images/right.png' />"),$("#input-category-icon").val(a.icon);var b='<div><img  src="'+a.icon+'" class="upload_image img-thumbnail" /></div>';$("#icon-path").val(a.icon),$("#preview-icon").html(b).removeClass("hidden"),$(".check-icon").removeClass("hidden"),$("#choose-icon").attr("title",a.icon),$("#category-type").val(a.type),$("#category-type").attr("disabled","disabled"),$("#recommend_app_1").val(a.demo_app[0]),$("#recommend_app_2").val(a.demo_app[1]),$("#category-description").val(a.description),$("#operate-category-title").html("修改分类")}else bootbox.alert(a.msg)}}),$("#category-add").modal("show")})});