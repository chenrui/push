/*! appstore */
function reset_add_activity_form(){$("#activity-name-check").html(""),$("#input-act-id").val("-1"),$("#add-act-name").val(""),$("#selected-activity-banner").val(""),$("#input-act-banner").val(""),$("#btn-activity-banner").parent().find("img").attr("src",""),$("#add-act-desc").val(""),$("#operate-activity-title").html("新增活动"),$("#add-act-detail").val("")}$(function(){bootbox.setDefaults({locale:"zh_CN"});var a,b={width:"100%",height:"270",items:["fontname","fontsize","|","forecolor","bold","italic","underline","|","justifyleft","justifycenter","justifyright","justifyfull","|","insertorderedlist","insertunorderedlist","|","indent","outdent"],resizeType:0};$("#btn-add-act").click(function(){$("#btn-add-act-real").click()}),$("#act-add-btn").click(function(){a?a.html(""):a=KindEditor.create("#add-act-detail",b),reset_add_activity_form(),$("#act-info").modal("show")}),$("#add-act-name").blur(function(){$.isNull($.trim($(this).val()))?$("#activity-name-check").html(""):$.strLength($.trim($(this).val()),1)&&$.sendAjax({url:"/admin/activity/name/check/",type:"POST",data:{name:$.trim($(this).val()),activity_id:$("#input-act-id").val()},callback:function(a){$("#activity-name-check").html("success"==a.status?"<img src='/static/common/images/right.png' />":"<img src='/static/common/images/error.png' /><span class='label label-warning'>"+a.msg+"</span>")}})});var c=function(a,b){var d={url:"/admin/activity/banner/upload/",secureuri:!1,fileElementId:a,dataType:"json",beforeSend:function(){},success:function(a){"success"==a.status?($("#"+b).parent().find("img").attr("src","/download/"+a.img_path),$("#"+b).parent().find("img").removeClass("hidden"),$("#input-act-banner").val(a.img_path)):bootbox.alert(a.msg),$("#activity-banner-file").change(function(){var a=$(this).parent().parent().find("input[type='text']");return $.checkFileSuffix($("#activity-banner-file").val(),"img")?($("#selected-activity-banner").val(this.value),$.ajaxFileUpload(c("activity-banner-file","btn-activity-banner")),void a.val($(this).val())):void bootbox.alert("请上传.png或者.jpg文件")})}};return d};$("#btn-activity-banner").click(function(){$(this).parent().parent().find("input[type='text']");$("#activity-banner-file").click()}),$("#activity-banner-file").change(function(){var a=$(this).parent().parent().find("input[type='text']");return $.checkFileSuffix($("#activity-banner-file").val(),"img")?($.ajaxFileUpload(c("activity-banner-file","btn-activity-banner")),void a.val($(this).val())):void bootbox.alert("请上传.png或者.jpg文件")}),$(".act-modify").click(function(){reset_add_activity_form(),a||(a=KindEditor.create("#add-act-detail",b)),a.sync(),$.sendAjax({url:"/admin/activity/info/",type:"POST",data:{activity_id:$(this).attr("value")},callback:function(b){if("success"==b.status){$("#input-act-id").val(b.activity_id),$("#add-act-name").val(b.name),$("#activity-name-check").html("<img src='/static/common/images/right.png' />");var c=b.banner.split("/"),c=c[c.length-1];$("#selected-activity-banner").val(c),$("#input-act-banner").val(b.banner),$("#btn-activity-banner").parent().find("img").attr("src","/download/"+b.banner),$("#btn-activity-banner").parent().find("img").removeClass("hidden"),$("#add-act-desc").val(b.description),a.html(b.detail),$("#operate-activity-title").html("修改活动")}else bootbox.alert(b.msg)}}),$("#act-info").modal("show")}),$("#act-throw-btn").click(function(){$(".choose-box .jtree").html(""),$(".result-box .jtree").html(""),$(".selected-count").html("0");var a=$.checkboxVal("mp-check-item");if(a.length>0){var b={url:"/admin/activity/throw/",type:"GET",callback:function(a){$("#act-throw-ul").checkboxTree(a.data,"activity-throw-node")}};$.sendAjax(b),$("#act-throw").modal("show")}else bootbox.alert("请先选择活动，然后才能进行投放!",function(){})}),$("#act-throw-yes-btn").click(function(){var a=$.checkboxVal("activity-throw-node"),b=$.checkboxVal("mp-check-item");if(a.length>0){var c={};c.activity_ids=b,c.checked_nodes=a;var d={url:"/admin/activity/throw/",data:c};$.sendAjax(d)}else bootbox.alert("请选择要投放到的模块!",function(){})}),$("#act-throw-ul").delegate(".add-block","click",function(){var a,b;if($(this).parent().find("ul.has-children").length){if(a=$(this).parent().attr("data-id"),b=$(this).parent().attr("data-txt"),!$(".result-box").find("li[data-id="+a+"]").length){var c=$('<li class="list-group-item cate" data-id="'+a+'">'+b+'<a class="glyphicon glyphicon-chevron-left pull-right remove-block" title="移除版块"></a><ul class="has-children"></ul></li>');c.appendTo($(".result-box ul.jtree"))}var d=parseInt($(".selected-count").html())+$(this).parent().find("ul.has-children>li").length;$(this).parent().find("ul.has-children>li").appendTo($(".result-box").find("li[data-id="+a+"] ul.has-children")),$(".selected-count").html(d),$(this).parent().find(".j-switch .glyphicon").hasClass("glyphicon-plus")&&$(this).parent().find(".j-switch").click()}else{if(a=$(this).parent().attr("data-id"),b=$(".choose-box").find("li.list-group-item[data-id=-1]").attr("data-txt"),!$(".result-box").find("li[data-id=-1]").length){var c=$('<li class="list-group-item cate" data-id="-1">'+b+'<a class="glyphicon glyphicon-chevron-left pull-right remove-block" title="移除版块"></a><ul class="has-children"></ul></li>');c.appendTo($(".result-box ul.jtree"))}$(this).parent().appendTo($(".result-box").find("li[data-id=-1] ul.has-children"));var d=parseInt($(".selected-count").html())+1;$(".selected-count").html(d)}}),$(".result-box").delegate(".remove-block","click",function(){var a,b,c;if($(this).parent().find("ul.has-children").length)a=$(this).parent().attr("data-id"),b=$(".choose-box").find("li.list-group-item[data-id="+a+"]").find("ul.has-children"),c=parseInt($(".selected-count").html())-$(this).parent().find("ul.has-children>li").length,$(this).parent().find("ul.has-children li").appendTo(b),$(this).parent().remove();else{a=$(this).parent().attr("data-id").split("-")[0],b=$(".choose-box").find("li.list-group-item[data-id=-1]").find("ul.has-children");var d=$(this).parent();1==$(this).parent().parent().find("li").length&&$(this).parent().parent().parent().remove(),d.appendTo(b),c=parseInt($(".selected-count").html())-1}$(".selected-count").html(c)}),$(".act-down").click(function(){var a=$(this).attr("value");bootbox.confirm("请确定是否下架所选活动?",function(b){b&&(params={url:"/admin/activity/offshelf/",data:{activity_id:a}},$.sendAjax(params))})}),$(".act-up").click(function(){var a=$(this).attr("value");bootbox.confirm("请确定是否上架所选活动?",function(b){if(b){var c={url:"/admin/activity/onshelf/",data:{activity_id:a}};$.sendAjax(c)}})}),$("#act-del-btn").click(function(){var a=$.checkboxVal("mp-check-item");a.length>0?bootbox.confirm("请确定是否删除所选活动?",function(b){b&&(params={url:"/admin/activity/delete/",data:{activity_ids:a}},$.sendAjax(params))}):bootbox.alert("请先选择活动，然后才能进行删除操作!",function(){})}),$(".activity_priority").update("/admin/activity/priority/update/"),$(".activity_app_priority").update("/admin/activity/list/priority/update/"+$("#btn-activity-app-list").attr("value")+"/"),$("#btn-activity-app-list").click(function(){var a=$.checkboxVal("mp-check-item"),b=$(this).attr("value");a.length>0?bootbox.confirm("选择下架后，你投放的资源将被移除，是否继续？",function(c){if(c){var d={url:"/admin/offshelf_app_from_activity/"+b+"/",data:{app_ids:a}};$.sendAjax(d)}}):bootbox.alert("请先选择，然后才能进行下架操作!",function(){})})});